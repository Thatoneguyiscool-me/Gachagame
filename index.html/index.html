<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JJ's Casino Gacha Game</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1a1a1a;
      color: #eee;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-bottom: 10px;
      color: #f39c12;
      text-shadow: 0 0 5px #f39c12;
    }
    button {
      background: #f39c12;
      border: none;
      color: #222;
      font-weight: bold;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      border-radius: 5px;
      transition: background 0.3s ease;
      box-shadow: 0 2px 5px rgba(243, 156, 18, 0.7);
    }
    button:hover {
      background: #d17f0e;
      box-shadow: 0 3px 8px rgba(209, 127, 14, 0.9);
    }
    #slots {
      font-size: 3rem;
      margin: 20px 0;
      letter-spacing: 1.5rem;
      user-select: none;
      color: #f1c40f;
      text-shadow: 0 0 10px #f1c40f;
      font-family: 'Courier New', Courier, monospace;
    }
    #levelDisplay, #achievementsDisplay, #cashDisplay {
      margin: 8px 0;
      font-size: 1.2rem;
    }
    #rollHistory {
      margin-top: 20px;
      width: 320px;
      max-height: 180px;
      overflow-y: auto;
      background: #333;
      border-radius: 8px;
      padding: 10px;
      box-shadow: inset 0 0 8px #222;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9rem;
    }
    #rollHistory div {
      padding: 2px 0;
      border-bottom: 1px solid #444;
    }
    #rollHistory div:last-child {
      border-bottom: none;
    }
    #messageBox {
      margin-top: 15px;
      background: #222;
      padding: 10px 15px;
      width: 320px;
      min-height: 50px;
      border-radius: 8px;
      box-shadow: inset 0 0 8px #111;
      font-size: 1rem;
      color: #f39c12;
      font-weight: bold;
      user-select: none;
    }
    #storeModal {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px #f39c12;
      color: #eee;
      max-width: 90vw;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 1000;
    }
    #storeModal h2 {
      margin-top: 0;
      color: #f1c40f;
    }
    #storeModal ul {
      list-style: none;
      padding: 0;
    }
    #storeModal li {
      margin: 8px 0;
      padding: 8px;
      background: #333;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #storeModal button {
      padding: 6px 12px;
      font-size: 0.9rem;
    }
    #modalCloseBtn {
      background: #c0392b;
      color: #fff;
      font-weight: bold;
      float: right;
      margin-bottom: 10px;
    }
    #diceResult {
      font-size: 2rem;
      margin: 10px 0;
      color: #f39c12;
      text-shadow: 0 0 8px #f39c12;
      user-select: none;
    }
    @media (max-width: 400px) {
      #slots {
        font-size: 2rem;
        letter-spacing: 1rem;
      }
      #rollHistory, #messageBox {
        width: 100%;
      }
      #storeModal {
        width: 95vw;
        height: 70vh;
      }
    }
  </style>
</head>
<body>

  <h1>JJ's Casino Gacha Game</h1>

  <div>
    <button id="rollButton">Roll Gacha</button>
    <button id="multiRollButton">Multi Roll (10x)</button>
    <button id="storeButton">Open Store</button>
    <button id="diceButton">Play Dice Game</button>
  </div>

  <div id="slots" aria-label="Gacha Slots">
    <span id="slot1">-</span> | 
    <span id="slot2">-</span> | 
    <span id="slot3">-</span>
  </div>

  <div id="levelDisplay">Level: 1 (XP: 0)</div>
  <div id="achievementsDisplay">No achievements yet</div>
  <div id="cashDisplay">Cash: $0</div>

  <div id="rollHistory" aria-label="Roll History">
    Roll history will appear here.
  </div>

  <div id="messageBox" aria-live="polite"></div>

  <div id="diceResult"></div>

  <div id="storeModal" role="dialog" aria-modal="true" aria-labelledby="storeTitle">
    <button id="modalCloseBtn">Close</button>
    <h2 id="storeTitle">Character Store & Buffs</h2>
    <ul id="characterList"></ul>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Elements
      const rollBtn = document.getElementById('rollButton');
      const multiRollBtn = document.getElementById('multiRollButton');
      const storeBtn = document.getElementById('storeButton');
      const diceBtn = document.getElementById('diceButton');

      const slot1 = document.getElementById('slot1');
      const slot2 = document.getElementById('slot2');
      const slot3 = document.getElementById('slot3');

      const levelDisplay = document.getElementById('levelDisplay');
      const achievementsDisplay = document.getElementById('achievementsDisplay');
      const cashDisplay = document.getElementById('cashDisplay');
      const rollHistoryContainer = document.getElementById('rollHistory');
      const messageBox = document.getElementById('messageBox');
      const diceResult = document.getElementById('diceResult');

      const storeModal = document.getElementById('storeModal');
      const modalCloseBtn = document.getElementById('modalCloseBtn');
      const characterList = document.getElementById('characterList');

      // Game State
      let playerLevel = 1;
      let playerXP = 0;
      let cash = 0;
      let rollHistory = [];
      let achievements = new Set();

      // Character data (example)
      const characters = [
        { id: 'c1', name: 'Sakura', buffDesc: 'Cash +5%', unlocked: false, buffMultiplier: 1.05, price: 100 },
        { id: 'c2', name: 'Kaito', buffDesc: 'Cash +10%', unlocked: false, buffMultiplier: 1.10, price: 500 },
        { id: 'c3', name: 'Yume', buffDesc: 'Cash +20%', unlocked: false, buffMultiplier: 1.20, price: 1000 },
      ];

      // Calculate total buff multiplier from unlocked characters
      function getTotalBuffMultiplier() {
        let multiplier = 1;
        characters.forEach(c => {
          if (c.unlocked) multiplier *= c.buffMultiplier;
        });
        return multiplier;
      }

      // Utility random integer inclusive
      function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      // Update slots display
      function updateSlots(nums) {
        slot1.textContent = nums[0];
        slot2.textContent = nums[1];
        slot3.textContent = nums[2];
      }

      // Add XP and check level up
      function addXP(amount) {
        playerXP += amount;
        while (playerXP >= 100) {
          playerXP -= 100;
          playerLevel++;
          displayMessage(`Congrats! You leveled up to ${playerLevel}!`);
          updateAchievements();
        }
        updateDisplays();
      }

      // Update level, XP, cash and achievements display
      function updateDisplays() {
        levelDisplay.textContent = `Level: ${playerLevel} (XP: ${playerXP})`;
        cashDisplay.textContent = `Cash: $${cash.toFixed(2)}`;
        updateRollHistoryUI();
        updateAchievementsUI();
      }

      // Update roll history UI
      function updateRollHistoryUI() {
        rollHistoryContainer.innerHTML = '';
        rollHistory.forEach((roll, i) => {
          const div = document.createElement('div');
          div.textContent = `Roll ${i + 1}: ${roll.join(' | ')}`;
          rollHistoryContainer.appendChild(div);
        });
      }

      // Update achievements UI
      function updateAchievementsUI() {
        if (playerLevel >= 100) achievements.add('God');
        else if (playerLevel >= 50) achievements.add('Pro');
        else if (playerLevel >= 10) achievements.add('Basic');
        else achievements.add('Rookie');

        achievementsDisplay.textContent = 'Achievements: ' + [...achievements].join(', ');
      }

      // Display messages in message box
      function displayMessage(text) {
        messageBox.textContent = text;
        setTimeout(() => {
          if (messageBox.textContent === text) messageBox.textContent = '';
        }, 4000);
      }

      // Roll gacha once
      function rollGacha() {
        const nums = [getRandomInt(1,9), getRandomInt(1,9), getRandomInt(1,9)];
        updateSlots(nums);
        rollHistory.push(nums);
        if (rollHistory.length > 10) rollHistory.shift();

        // Cash reward: base $10 per roll, multiplied by buffs
        const baseCash = 10;
        const totalMultiplier = getTotalBuffMultiplier();
        const earned = baseCash * totalMultiplier;
        cash += earned;

        // XP per roll
        addXP(10);

        // Try to unlock character if slots are all equal (simple rule)
        if (nums[0] === nums[1] && nums[1] === nums[2]) {
          unlockCharacterRandom();
        }

        updateDisplays();
        displayMessage(`You earned $${earned.toFixed(2)} from the roll!`);
      }

      // Unlock a random locked character from the pool
      function unlockCharacterRandom() {
        const lockedChars = characters.filter(c => !c.unlocked);
        if (lockedChars.length === 0) {
          displayMessage('All characters unlocked!');
          return;
        }
        const chosen = lockedChars[getRandomInt(0, lockedChars.length -1)];
        chosen.unlocked = true;
        displayMessage(`Congrats! You unlocked character: ${chosen.name}!`);
      }

      // Multi-roll 10 times
      function multiRoll(count = 10) {
        for (let i = 0; i < count; i++) {
          rollGacha();
        }
        displayMessage(`Completed ${count} rolls.`);
      }

      // Dice mini-game: roll 1-6, earn cash based on number
      function playDice() {
        const roll = getRandomInt(1, 6);
        diceResult.textContent = `Dice rolled: ${roll}`;
        let earned = 0;

        switch (roll) {
          case 6: earned = 50; break;  // Jackpot!
          case 5: earned = 20; break;
          case 4: earned = 15; break;
          case 3: earned = 10; break;
          case 2: earned = 5; break;
          case 1: earned = 1; break;
        }

        // Apply buffs
        const totalMultiplier = getTotalBuffMultiplier();
        earned *= totalMultiplier;
        cash += earned;

        updateDisplays();
        displayMessage(`Dice game: You earned $${earned.toFixed(2)}!`);
      }

      // Store UI render
      function renderStore() {
        characterList.innerHTML = '';
        characters.forEach(char => {
          const li = document.createElement('li');
          li.textContent = `${char.name} - Buff: ${char.buffDesc} - Price: $${char.price}`;
          if (char.unlocked) {
            const span = document.createElement('span');
            span.textContent = ' (Unlocked)';
            span.style.color = '#2ecc71';
            li.appendChild(span);
          } else {
            const buyBtn = document.createElement('button');
            buyBtn.textContent = 'Buy';
            buyBtn.disabled = cash < char.price;
            buyBtn.onclick = () => {
              if (cash >= char.price) {
                cash -= char.price;
                char.unlocked = true;
                updateDisplays();
                renderStore();
                displayMessage(`You bought ${char.name}!`);
              } else {
                displayMessage('Not enough cash to buy this character.');
              }
            };
            li.appendChild(buyBtn);
          }
          characterList.appendChild(li);
        });
      }

      // Open store modal
      function openStore() {
        renderStore();
        storeModal.style.display = 'block';
      }
      // Close store modal
      modalCloseBtn.onclick = () => {
        storeModal.style.display = 'none';
      };

      // Click outside modal to close
      window.onclick = (e) => {
        if (e.target === storeModal) {
          storeModal.style.display = 'none';
        }
      };

      // Attach button events
      rollBtn.addEventListener('click', rollGacha);
      multiRollBtn.addEventListener('click', () => multiRoll(10));
      storeBtn.addEventListener('click', openStore);
      diceBtn.addEventListener('click', playDice);

      // Init display
      updateDisplays();
      updateAchievementsUI();
      updateRollHistoryUI();
      updateSlots(['-', '-', '-']);
      diceResult.textContent = '';
      messageBox.textContent = '';
    });
  </script>
</body>
</html>
